---
title: "live-image"
author: "YinCY"
date: "7/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(janitor)
library(magrittr)
library(pipeR)
library(patchwork)
library(readxl)

my_theme <- theme_classic() +
  theme(axis.title = element_text(face = "bold", size = 15),
        axis.text = element_text(face = "bold", size = 13), 
        title = element_text(face = "bold", size = 15))

get_pval <- function(x){
  x[[1]][1, 5]
}
```

# experiment flow
```{r}
tiff(filename = "experiemnt-flow.tiff", 
     height = 200, width = 1000, 
     res = 100)
par(mai = c(0, 0, 0, 0))
plot(x = 0:32, y = 0:32, 
     type = "n", 
     xlab = NA, 
     ylab = NA, 
     xaxt = "n", 
     yaxt = "n", 
     bty = "n")
# main arrows
arrows(x0 = 0, y0 = 14, 
       x1 = 32, y1 = 14, 
       lwd = 3, 
       length = 0.1)

# bottom arrows
arrows(x0 = seq(1, 30, 2), 
       y0 = 11, 
       x1 = seq(1, 30, 2), 
       y1 = 13.5, 
       length = 0.07)
text(x = seq(1, 30, 2), 
     y = 10, 
     labels = paste("day", -3:11), 
     cex = 0.6)

text(x = c(1, 3, 5, 7, seq(11, 30, 4)), 
     y = 7, 
     labels = "Tamoxifen or \nCorn Oil", 
     cex = 0.5)

# top arrows
arrows(x0 = c(7, 29),
       y0 = 17,
       x1 = c(7, 29), 
       y1 = 14.5, 
       length = 0.07)
text(x = c(7, 29), 
     y = 18.5, 
     labels = c("PB3 inoculation", "live image"), 
     cex = 0.5)

dev.off()
```


# live image data
## 20210204
```{r}
li_20210204 <- read.csv("G:/data/live-image/20210204/210204 - stat.csv") %>% 
  clean_names()
```

```{r}
set.seed(117)
li_20210204 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(total_flux_p_s), 
         se = sd(total_flux_p_s)/sqrt(n - 1)) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(aes(fill = group), stat = "identity", position = "dodge", width = 0.4) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, total_flux_p_s), size = 2, width = 0.1) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "photons/sec") +
  theme_classic() +
  ggtitle("PB3") +
  scale_fill_discrete(name = NULL) +
  theme(axis.text = element_text(face = "bold", size = 13), 
        legend.position = "none", 
        axis.title.y = element_text(size = 15))

ggsave("G:/data/live-image/20210204/20210204-live-image-1.tiff", 
       width = 7, height = 7)
```


## 20210222
```{r}
li_20210222 <- read.csv("G:/data/live-image/20210222/20210222 - stat.csv") %>% 
  clean_names()
```

```{r}
li_20210222 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(total_flux_p_s), 
         se = sd(total_flux_p_s)/sqrt(n - 1)) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.4) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, total_flux_p_s), size = 2, width = 0.1) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "photons/sec") +
  theme_classic() +
  ggtitle("PB3") +
  theme(axis.text = element_text(face = "bold", size = 10))

ggsave("G:/data/live-image/20210222/20210222-live-image.tiff", 
       width = 5, height = 7)
```


## 20210531
```{r}
# li_20210531_KP_B6 <- read.csv("G:/data/live-image/20210531/20210531-KP-B6/20210531-KP-B6-stat.csv")
li_20210531_PB3 <- read.csv("G:/data/live-image/20210531/20210531-PB3/20210531 - PB3 - stat.csv") %>% 
  clean_names()
```

```{r}
# p1 <- li_20210531_KP_B6 %>% 
#   group_by(group) %>% 
#   mutate(mean = mean(Avg.Radiance..p.s.cm2.sr.), 
#          sd = sd(Avg.Radiance..p.s.cm2.sr.), 
#          se = ifelse(group == "TAM", sd/sqrt(4-1), sd/sqrt(3-1))) %>% 
#   ggplot() +
#   geom_bar(aes(group, mean), stat = "identity", position = "dodge", width = 0.4) +
#   geom_errorbar(aes(x = group, ymin = mean - se, ymax = mean + se), width = 0.1) +
#   geom_jitter(aes(group, Avg.Radiance..p.s.cm2.sr.), width = 0.1, size = 2) +
#   theme_classic() +
#   scale_x_discrete(name = NULL) +
#   scale_y_continuous(name = expression(paste("Avg Radiance ", (photons/sec/cm^2/sr)))) +
#   ggtitle(label = "KP-B6")

li_20210531_PB3 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(total_flux_p_s), 
         se = sd(total_flux_p_s)/sqrt(n - 1)) %>% 
  ggplot() +
  geom_bar(aes(group, mean), stat = "identity", width = 0.4, position = "dodge") +
  geom_errorbar(aes(group, ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, total_flux_p_s), width = 0.1, size = 2) +
  theme_classic() +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "photons/sec") +
  ggtitle("PB3") +
  theme(axis.text = element_text(face = "bold", size = 10))
ggsave("G:/data/live-image/20210531/20210531-live-image.tiff", width = 5, height = 7)
```



## 20210702
```{r}
li_20210702 <- read.csv("G:/data/live-image/20210702/20210702-PB3-stat.csv") %>% 
  clean_names()

li_20210702 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(total_flux_p_s), 
         se = sd(total_flux_p_s) / sqrt(n - 1)) %>% 
  ggplot()+
  geom_bar(aes(group, mean), stat = "identity", width = 0.4, position = "dodge") +
  geom_errorbar(aes(group, ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, total_flux_p_s), width = 0.1, size = 2) +
  theme_classic() +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "photons/sec") +
  ggtitle("PB3") +
  theme(axis.text = element_text(face = "bold", size = 10))

ggsave("G:/data/live-image/20210702/20210702-live-image.tiff", 
       width = 5, height = 7)
```

## 20210815
```{r}
pb3_wt <- read.csv("G:/data/live-image/20210815/20210815-PB3-stat.csv") %>% 
  clean_names()
pb3_wt %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(total_flux_p_s), 
         se = sd(total_flux_p_s)/sqrt(n - 1)) %>% 
  ggplot() +
  geom_bar(aes(group, mean), stat = "identity", width = 0.4, position = "dodge") +
  geom_errorbar(aes(group, ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, total_flux_p_s), width = 0.1, size = 2) +
  theme_classic() +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "photons/sec") +
  labs(title = "PB3") +
  theme(axis.text = element_text(face = "bold", size = 10))

ggsave("G:/data/live-image/20210815/20210815-live-image.tiff", 
       width = 5, height = 7)
```

## PB3 flod change
```{r}
pooled <- readxl::read_xlsx("G:/data/live-image/PB3-tumor-pooled-together.xlsx", 
                            sheet = "Sheet1") %>% 
  clean_names()
pooled_aov <- aov(normalized ~ group, data = pooled) %>% summary
t.test(normalized ~ group, data = pooled)
```

```{r}
pooled %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         normalized_log2 = log2(normalized), 
         mean = mean(normalized_log2), 
         se = sd(normalized_log2)/sqrt(n - 1)) %>% 
  ggplot() +
  # geom_bar(aes(group, mean), stat = "identity", position = position_dodge()) +
  # geom_errorbar(aes(x = group, y = mean, ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_boxplot(aes(group, normalized_log2)) +
  geom_jitter(aes(group, normalized_log2), width = 0.1) +
  geom_segment(aes(x = 1, y = max(normalized_log2) * 1.2, 
                   xend = 2, yend = max(normalized_log2) * 1.2)) +
  geom_text(aes(x = 1.5, y = max(normalized_log2) * 1.25, 
                label = "**")) +
  scale_y_continuous(name = paste("log2 Fold change of \nphontons per second")) +
  scale_x_discrete(name = NULL) +
  my_theme

ggsave("G:/data/live-image/PB3-Pdgfb-pooled.tiff", 
       width = 7, height = 10)
```


# sensory nerve renal tumor
## 20220117
tumor sensory nerve
```{r}
pb2 <- read.csv("G:/data/live-image/20220117/stat-20220117.csv")
```


```{r}
pb2 %>% 
  group_by(group) %>% 
  mutate(mean = mean(Avg.Radiance..p.s.cm.sr.), 
         sd = sd(Avg.Radiance..p.s.cm.sr.), 
         se = sd / sqrt(4 - 1)) %>% 
  ggplot() +
  geom_bar(aes(group, mean), stat = "identity", width = 0.4, position = "dodge") +
  geom_errorbar(aes(group, ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, Avg.Radiance..p.s.cm.sr.), width = 0.1, size = 2) +
  theme_classic() +
  scale_x_discrete(name = NULL, labels = c("Capsaicin (n = 4)", "Control (n = 3)")) +
  scale_y_continuous(name = expression(paste("Avg Radiance ", (photons/sec/cm^2/sr)))) +
  labs(title = "PB2") +
  theme(axis.text.x = element_text(size = 15), 
        axis.title.y = element_text(size = 10))

ggsave("G:/data/live-image/20220117/20220117-PB2.tiff")
```

## 20220124
tumor sensory nerve
```{r}
pb2 <- read.csv("G:/data/live-image/20220124/stat-20220124.csv")
```

```{r}
pb2 %>% 
  group_by(group) %>% 
  mutate(mean = mean(Avg.Radiance..p.s.cm.sr.), 
         sd = sd(Avg.Radiance..p.s.cm.sr.), 
         se = sd / sqrt(4 - 1)) %>% 
  ggplot() +
  geom_bar(aes(group, mean), stat = "identity", width = 0.4, position = "dodge") +
  geom_errorbar(aes(group, ymin = mean - se, ymax = mean + se), width = 0.1) +
  geom_jitter(aes(group, Avg.Radiance..p.s.cm.sr.), width = 0.1, size = 2) +
  theme_classic() +
  scale_x_discrete(name = NULL, labels = c("Capsaicin (n = 4)", "Control (n = 3)")) +
  scale_y_continuous(name = expression(paste("Avg Radiance ", (photons/sec/cm^2/sr)))) +
  labs(title = "PB2") +
  theme(axis.text.x = element_text(size = 15), 
        axis.title.y = element_text(size = 10))

ggsave("G:/data/live-image/20220124/20220124-pb2.tiff")
```


# PB3 Pdgfr inhibitor in vitro assay
## CCK8 20220304
```{r}
cck8_0304 <- readxl::read_xlsx("G:/data/kidney/Tumor/CCK8/20220304-cck8-pdgfr-inhibitor-1h.xlsx", 
                          sheet = "Sheet1")

cck8_0304 %>% group_by(group) %>% 
  mutate(mean = mean(OD450),
         n = n(),
         se = sd(OD450) / sqrt(n -1)) %>% 
  mutate(group = factor(group, levels = c("Control", 
                                          "1.0uM Pdgfr inhibitor", 
                                          "5.0uM Pdgfra inhibitor", 
                                          "10.0uM Pdgfrb inhibitor"))) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = position_dodge(), width = 0.6) +
  geom_jitter(aes(group, OD450),width = 0.2) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "OD450") +
  theme_classic() +
  theme(axis.text = element_text(hjust = 0.5, face = "bold", size = 10)) 

ggsave("G:/data/kidney/Tumor/CCK8/20220304-Pdgfr-inhibitor-cck8.tiff", 
       width = 10, height = 7)
```

## CCK8 20220404
```{r}
# 1h after CCK8 addition
cck8_0404 <- readxl::read_xlsx("G:/data/kidney/Tumor/CCK8/20220404-PB3-Pdgfr-inhibitor-CCK8-450.xlsx", 
                               sheet = "Sheet1")

cck8_0404 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(OD450), 
         se = sd(OD450) / sqrt(n - 1), 
         group = factor(group, levels = c("Control", 
                                          "0.1uM Pdgfr inhibitor", 
                                          "1.0uM Pdgfr inhibitor", 
                                          "0.5uM Pdgfra inhibitor", 
                                          "5.0uM Pdgfra inhibitor", 
                                          "1.0uM Pdgfrb inhibitor", 
                                          "10.0uM Pdgfrb inhibitor"))) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_jitter(aes(group, OD450), width = 0.2) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "OD450") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = -60, vjust = 0, hjust = 0, size = 8, face = "bold"), 
        axis.text.y = element_text(face = "bold", size = 10)) 

ggsave("G:/data/kidney/Tumor/CCK8/20220404-pdgfr-inhibitor-cck8.tiff", width = 10, height = 7)
```


## CCK8 20220408
```{r}
cck8_0408 <- readxl::read_xlsx("G:/data/kidney/Tumor/CCK8/20220408-pb3-cck8.xlsx", 
                               sheet = "Sheet1")

cck8_0408 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(OD450), 
         se = sd(OD450)/sqrt(n - 1), 
         group = factor(group, levels = c("Control", 
                                          "0.1uM Pdgfr inhibitor", 
                                          "1.0uM Pdgfr inhibitor", 
                                          "0.5uM Pdgfra inhibitor", 
                                          "5.0uM Pdgfra inhibitor", 
                                          "1.0uM Pdgfrb inhibitor", 
                                          "10.0uM Pdgfrb inhibitor"))) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.2)) +
  geom_jitter(aes(group, OD450), width = 0.2) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "OD450") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = -60, hjust = 0, size = 8, face = "bold"), 
        axis.text.y = element_text(face = "bold", size = 10)) 

ggsave("G:/data/kidney/Tumor/CCK8/20220408-Pdgfr-inhibitor-cck8.tiff", 
       width = 10, height = 7)
```



# fluoresence microscope
## a-SMA profile plot
```{r}
# Corn Oil
pb3_corn_oil1 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/a-SMA/intensity-plot/PB3-Corn-Oil-a-SMA-intensity-boundary-450-2.csv") %>% clean_names()
pb3_corn_oil2 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/a-SMA/intensity-plot/PB3-Corn-Oil-a-SMA-intensity-boundary-440-3.csv") %>% clean_names()
pb3_corn_oil3 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/a-SMA/intensity-plot/PB3-Corn-Oil-a-SMA-intensity-boundary-860-4.csv") %>% clean_names()
pb3_corn_oil4 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/a-SMA/intensity-plot/PB3-Corn-Oil-a-SMA-intensity-boundary-520-5.csv") %>% clean_names()

# boundary alignment 190
align <- 260
pb3_corn_oil1_normal_gray_value <- pb3_corn_oil1 %>% 
  filter(distance_microns < 450) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_corn_oil1_normalized <- pb3_corn_oil1 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align,
         Gray_Value_normalized = round(gray_value / pb3_corn_oil1_normal_gray_value, 3))
pb3_corn_oil1_normalized$file <- factor("Corn Oil 1")


align <- 250
pb3_corn_oil2_normal_gray_values <- pb3_corn_oil2 %>% 
  filter(distance_microns < 440) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_corn_oil2_normalized <- pb3_corn_oil2 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align, 
         Gray_Value_normalized = round(gray_value / pb3_corn_oil2_normal_gray_values, 3))
pb3_corn_oil2_normalized$file <- factor("Corn Oil 2")


align <- 670
pb3_corn_oil3_normal_gray_values <- pb3_corn_oil3 %>% 
  filter(distance_microns < 860) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_corn_oil3_normalized <- pb3_corn_oil3 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align, 
         Gray_Value_normalized = round(gray_value / pb3_corn_oil3_normal_gray_values, 3)) 
pb3_corn_oil3_normalized$file <- factor("Corn Oil 3")


align <- 330
pb3_corn_oil4_normal_gray_values <- pb3_corn_oil4 %>% 
  filter(distance_microns < 520) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_corn_oil4_normalized <- pb3_corn_oil4 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align, 
         Gray_Value_normalized = round(gray_value / pb3_corn_oil4_normal_gray_values, 3))
pb3_corn_oil4_normalized$file = factor("Corn Oil 4")

pb3_corn_oil <- rbind(pb3_corn_oil1_normalized, 
                      pb3_corn_oil2_normalized, 
                      pb3_corn_oil3_normalized, 
                      pb3_corn_oil4_normalized)


# Tamoxifen
pb3_tam1 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/a-SMA/intensity-plot/PB3-TAM-a-SMA-intensity-plot-boundary-190-1.csv") %>% clean_names()
pb3_tam2 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/a-SMA/intensity-plot/PB3-TAM-a-SMA-intensity-plot-boundary-280-3.csv") %>% clean_names()
pb3_tam3 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/a-SMA/intensity-plot/PB3-TAM-a-SMA-intensity-plot-boundary-770-4.csv") %>% clean_names()
pb3_tam4 <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/a-SMA/intensity-plot/PB3-TAM-a-SMA-intensity-plot-boundary-210-5.csv") %>% clean_names()

# boundary alignment 190
align <- 190
pb3_tam1_normal_gray_value <- pb3_tam1 %>% 
  filter(distance_microns < 190) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_tam1_normalized <- pb3_tam1 %>% 
  mutate(Gray_Value_normalized = round(gray_value / pb3_tam1_normal_gray_value, 3))
pb3_tam1_normalized$file <- factor("Tamoxifen 1")

align <- 90
pb3_tam2_normal_gray_value <- pb3_tam2 %>% 
  filter(distance_microns < 280) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_tam2_normalized <- pb3_tam2 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align,
    Gray_Value_normalized = round(gray_value / pb3_tam2_normal_gray_value, 3))
pb3_tam2_normalized$file <- factor("Tamoxifen 2")

align <- 580
pb3_tam3_normal_gray_value <- pb3_tam3 %>% 
  filter(distance_microns < 770) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_tam3_normalized <- pb3_tam3 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align, 
         Gray_Value_normalized = round(gray_value / pb3_tam3_normal_gray_value, 3))
pb3_tam3_normalized$file <- factor("Tamoxifen 3")

align <- 20
pb3_tam4_normal_gray_value <- pb3_tam4 %>% 
  filter(distance_microns < 210) %>% 
  summarise(mean = mean(gray_value)) %>% 
  magrittr::extract2(1)
pb3_tam4_normalized <- pb3_tam4 %>% 
  filter(distance_microns > align) %>% 
  mutate(distance_microns = distance_microns - align, 
         Gray_Value_normalized = round(gray_value / pb3_tam4_normal_gray_value, 3))
pb3_tam4_normalized$file <- "Tamoxifen 4"


pb3_tam <- rbind(pb3_tam1_normalized, 
                 pb3_tam2_normalized,
                 pb3_tam3_normalized, 
                 pb3_tam4_normalized)

asma <- rbind(pb3_corn_oil, pb3_tam) 

library(stringr)
len <- str_count(asma$file, "[:alpha:]")
asma$group <- substr(asma$file, 1, len) %>% as.factor()
asma %>% head
asma %>% tail

aov(Gray_Value_normalized ~ distance_microns * group, data = asma) %>% summary
```


```{r}
set.seed(123)
asma %>% 
  ggplot(aes(distance_microns, Gray_Value_normalized)) +
  geom_line(aes(group = file, color = file)) +
  geom_vline(xintercept = 200, linetype = 2, size = 2, color = "gray40") +
  geom_segment(aes(x = max(distance_microns) * 1.01, 
                   y = 0.2, 
                   xend = max(distance_microns) * 1.01, 
                   yend = 1.3), 
               size = 1) +
  geom_text(aes(x = max(distance_microns) * 1.04, y = 0.75), angle = 90, label = "***") +
  theme_classic() +
  scale_color_brewer(name = NULL, type = "div", palette = 3) +
  scale_x_continuous(name = "Distance (um)") +
  scale_y_continuous(name = "normalized fluorsence intensity") +
  # labs(title = "fluoresence intensity of aSMA") + 
  my_theme

# dir.create("G:/data/kidney/Tumor/PB3/res-microscope")
ggsave("G:/data/kidney/Tumor/PB3/res-microscope/a-SMA-intensity-plot.tiff", width = 10, height = 7)
```


## a-SMA positive area
```{r}
pb3_corn_oil_asma <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/a-SMA/area/Results-PB3-Corn-Oil-aSMA-area.csv") %>% clean_names()
pb3_corn_oil_asma$group <- "Corn Oil"

pb3_tam_asma <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/a-SMA/area/Results-PB3-TAM-a-SMA-area.csv") %>% clean_names()
pb3_tam_asma$group <- "Tamoxifen"

asma_aov <- aov(x_area ~ group, data = rbind(pb3_corn_oil_asma, pb3_tam_asma)) %>% summary()


rbind(pb3_corn_oil_asma, pb3_tam_asma) %>% 
  group_by(group) %>% 
  mutate(mean = mean(x_area), 
         n = n(), 
         se = sd(x_area)/sqrt(n - 1)) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.1)) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_jitter(aes(y = x_area),width = 0.1) +
  geom_segment(aes(x = 1, y = max(x_area) * 1.1, 
                   xend = 2, yend = max(x_area) * 1.1)) +
  geom_text(aes(x = 1.5, y = max(x_area) * 1.14), label = "***") +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "Percentage of aSMA \npositive area") +
  my_theme

ggsave("G:/data/kidney/Tumor/PB3/res-microscope/a-SMA-positive-area.tiff", 
       width = 7, height = 10)
```


## F480 number of cells per view
```{r}
f480_corn_oil <- readxl::read_excel("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/F480/cells-per-region/PB3-Corn-Oil-F480-cells_per_region.xlsx") %>% clean_names()
f480_tam <- readxl::read_excel("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/F480/cells-per-region/PB3-TAM-F480-cells_per_region.xlsx") %>% clean_names()
```

```{r}
f480 <- rbind(f480_corn_oil, f480_tam)
aov(num_cells ~ group, data = f480) %>% summary()
t.test(num_cells ~ group, data = f480)

f480 %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(num_cells), 
         se = sd(num_cells)/sqrt(n - 1)) %>% 
  ggplot() +
  geom_bar(aes(group, mean), stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(x = group, y = mean, ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_jitter(aes(group, num_cells), width = 0.1) +
  geom_segment(aes(x = 1, y = max(num_cells) * 1.1, 
                   xend = 2, yend = max(num_cells) * 1.1)) +
  geom_text(aes(x = 1.5, y = max(num_cells) * 1.15), label = "ns") +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "number of F480 positive \ncells per view") +
  my_theme

ggsave("G:/data/kidney/Tumor/PB3/res-microscope/number-of-F480-positive-area.tiff", 
       width = 7, height = 7)
```


## CD31 angiotool
### junction density
```{r}
cd31_junction_corn <- read_excel("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/CD31/z-max-projection/junction/PB3-Corn-Oil-CD31-angiotools.xls", 
                                 skip = 3, 
                                 col_names = T) %>% 
  clean_names()

cd31_junction_tam <- read_excel("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/CD31/z-max-projection/junction/PB3-TAM-CD31-angiotools.xls", 
                                skip = 3, 
                                col_names = T) %>% 
  clean_names()

cd31_junction_corn %>% bind_rows(cd31_junction_tam) %>% 
  mutate(group = ifelse(grepl("Corn", image_name), "Corn Oil", "Tamoxifen")) %>>%
  (~ cd31_junction_density) %>% 
  select(junctions_density, group) %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(junctions_density), 
         se = sd(junctions_density)/sqrt(n - 1)) %>% 
  ggplot(aes(group, junctions_density)) +
  geom_bar(aes(group, mean), stat = "identity", position = position_dodge()) +
  geom_jitter(width = 0.1) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_segment(aes(x = 1, y = max(junctions_density) * 1.1, 
                   xend = 2, yend = max(junctions_density) * 1.1), 
               size = 1) +
  geom_text(aes(x = 1.5, y = max(junctions_density) * 1.12, label = "*")) +
  scale_y_continuous(name = expression(paste("junctions per  ", mm^2)), 
                     limits = c(0, max(cd31_junction_density$junctions_density) * 1.3)) +
  scale_x_discrete(name = NULL) +
  my_theme

aov(junctions_density ~ group, data = cd31_junction_density) %>% summary

ggsave("G:/data/kidney/Tumor/PB3/res-microscope/junctions_density.tiff", width = 7, height = 10)
```

```{r}
cd31_area_corn <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/CD31/z-max-projection/area/Results-PB3-Corn-Oil-CD31-area-fraction.csv") %>% 
  clean_names()
cd31_area_corn$group <- "Corn Oil"
cd31_area_tam <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/CD31/z-max-projection/area/Results-PB3-TAM-CD31-area-fraction.csv") %>% 
  clean_names()
cd31_area_tam$group <- "Tamoxifen"

cd31_area_corn %>% bind_rows(cd31_area_tam) %>>% 
  (~ cd31_area) %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(x_area), 
         se = sd(x_area)/sqrt(n - 1)) %>% 
  ggplot() +
  geom_bar(aes(group, mean), stat = "identity", position = position_dodge()) +
  geom_jitter(aes(group, x_area), size = 1.5, width = 0.1) +
  geom_segment(aes(x = 1, y = max(x_area) * 1.2, 
                   xend = 2, yend = max(x_area) * 1.2), 
               size = 1) +
  geom_text(aes(x = 1.5, y = max(x_area) * 1.25, label = "ns")) +
  scale_y_continuous(name = "Percentage of CD31 \npositive area", 
                     limits = c(0, 7), 
                     breaks = seq(0, 7, 2), 
                     labels = paste(seq(0, 7, 2), "%", sep = "")) +
  scale_x_discrete(name = NULL) +
  my_theme

aov(x_area ~ group, data = cd31_area) %>% summary
ggsave("G:/data/kidney/Tumor/PB3/res-microscope/cd31_positive_area.tiff", 
       width = 7, height = 10)
```

### Pdgfrb 
#### Area
```{r}
pdgfrb_area_corn_oil <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/Pdgfrb/area/Results-PB3-Corn-Oil-Pdgfrb-area-fraction.csv") %>% clean_names()
pdgfrb_area_corn_oil$group <- "Corn Oil"

pdgfrb_area_tam <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/Pdgfrb/area/Results-PB3-TAM-tumor-Pdgfrb-area-fraction.csv") %>% clean_names()
pdgfrb_area_tam$group <- "Tamoxifen"

pdgfrb_area_corn_oil %>% rbind(pdgfrb_area_tam) %>>%
  (~pdgfrb_area) %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(x_area), 
         se = sd(x_area)/sqrt(n - 1)) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_jitter(aes(group, x_area), width = 0.1) +
  geom_segment(aes(x = 1, y = max(x_area) * 1.1, 
                   xend = 2, yend = max(x_area) * 1.1)) +
  geom_text(aes(x = 1.5, y = max(x_area) * 1.12), label = "*") +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "Percentage of Pdgfrb \nPositive Area") +
  my_theme

pdgfrb_are_aov <- aov(x_area ~ group, data = pdgfrb_area) %>% summary
ggsave("G:/data/kidney/Tumor/PB3/res-microscope/Pdgfrb_positive_area.tiff", 
       width = 7, height = 10)
```

#### Cells per region
```{r}
pdgfrb_cell_corn_oil <- read_excel("G:/data/kidney/Tumor/PB3/kidney-PB3-corn-oil/Pdgfrb/cells_per_region/PB3-COrn-OIl-tumor-Pdgfrb-cells-per-region.xlsx") %>% clean_names()
pdgfrb_cell_tam <- read_excel("G:/data/kidney/Tumor/PB3/kidney-PB3-TAM/Pdgfrb/cells-per-region/PB3-TAM-tumor-Pdgfrb-cells-per-region.xlsx") %>% clean_names()

pdgfrb_cell_corn_oil %>% rbind(pdgfrb_cell_tam) %>>%
  (~ pdgfrb_cells) %>% 
  group_by(group) %>% 
  mutate(n = n(), 
         mean = mean(num_cells), 
         se = sd(num_cells)/sqrt(n - 1)) %>% 
  ggplot(aes(group, mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_jitter(aes(group, num_cells), width = 0.1) +
  geom_segment(aes(x = 1, y = max(num_cells) * 1.1, 
                   xend = 2, yend = max(num_cells) * 1.1)) +
  geom_text(aes(x = 1.5, y = max(num_cells) * 1.12), label = "**") +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "Number of Pdgfrb Positive \nCells per View") +
  my_theme

aov(num_cells ~ group, data = pdgfrb_cells) %>% summary
ggsave("G:/data/kidney/Tumor/PB3/res-microscope/Pdgfrb_cells_per-view.tiff", 
       width = 7, height = 10)
```



## PB3 WT
### a-SMA, Pdgfrb colocalization
```{r}
asma_pdgfrb_coloc <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-WT/a-SMA-Pdgfrb/PB3-WT-aSMA-Pdgfrb-colocalization.csv") %>% clean_names()

asma_pdgfrb_coloc %>%
  mutate(n = n(), 
         mean = mean(spearman_rank_corelation), 
         se = sd(spearman_rank_corelation)/sqrt(n - 1)) %>% 
  ggplot(aes(x = "aSMA Pdgfrb colocalization", y = mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_jitter(aes(y = spearman_rank_corelation), width = 0.1, size = 2) +
  scale_y_continuous(name = "Spearman Rank Corelation", limits = c(0, 0.45)) +
  scale_x_discrete(name = NULL) +
  my_theme

ggsave("G:/data/kidney/Tumor/PB3/kidney-PB3-WT/a-SMA-Pdgfrb/aSMA-Pdgfrb-colocalization.tiff", 
       width = 7, 
       height = 10)
```


### CD45, Pdgfrb
```{r}
cd45_pdgfrb_coloc <- read.csv("G:/data/kidney/Tumor/PB3/kidney-PB3-WT/CD45-Pdgfrb/PB3-WT-CD45-Pdgfrb-colocalization.csv") %>% clean_names()

cd45_pdgfrb_coloc %>% 
  mutate(n = n(), 
         mean = mean(spearman_rank_corelation), 
         se = sd(spearman_rank_corelation)/sqrt(n - 1)) %>% 
  ggplot(aes(x = "CD45 Pdgfrb colocalization", y = mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  geom_jitter(aes(y = spearman_rank_corelation), width = 0.1, size = 2) +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = "Spearman Rank Corelation", limits = c(0, 0.3)) +
  my_theme

ggsave("G:/data/kidney/Tumor/PB3/kidney-PB3-WT/CD45-Pdgfrb/CD45-Pdgfrb-Colocalization.tiff", 
       width = 7, 
       height = 10)
```



# RT-PCR
## PB3 Pdgf expression
```{r}
pb3_pdgfs <- readxl::read_xlsx("G:/data/RT-PCR/PB3/20210806/summary-20210806.xlsx")

pb3_pdgfs %>% 
  filter(!is.na(ddCt)) %>% 
  group_by(Gene) %>% 
  mutate(`2^-dCt` = 2^(-dCt), 
         mean = mean(`2^-dCt`), 
         n = n(), 
         se = sd(`2^-dCt`) / sqrt(n - 1)) %>% 
  ggplot(aes(Gene, mean)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_jitter(aes(Gene, `2^-dCt`), width = 0.1)+
  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +
  labs(title = "Pdgfs expression in PB3 cell line") +
  scale_x_discrete(name = NULL) +
  scale_y_continuous(name = expression(paste("relative expression to GAPDH   ", "( ",2^-dCt, " )"))) +
  theme_classic() +
  scale_fill_discrete(name = NULL) +
  theme(axis.text = element_text(face = "bold", size = 13), 
        axis.title.y = element_text(size = 15))

ggsave("G:/data/RT-PCR/PB3/20210806/Pdgfs-expression-in-pb3-cell-line.tiff", 
       width = 10, height = 7)
```

```{r}

```



